# 简单总结你实现的功能

重新实现了`sys_get_time` 和 `sys_task_info`这两个系统调用，将处理逻辑集中移动到了`task`内

新增了`mmap `和 `munmap` 匿名映射功能

# 请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？

 ![../_images/sv39-pte.png](https://learningos.cn/rCore-Tutorial-Guide-2024S/_images/sv39-pte.png)

`63 - 54`保留

`53 - 10`物理页号

`9 - 8`软件自定义使用

`7 - 0`标志位

标志位占用最低的几位，并定义了页表项的权限和状态。常见的标志位包括：

- **V (Valid, 有效位)** - 如果设置为 1，表示该页表项有效。
- **R (Read, 读权限)** - 如果设置为 1，表示允许从对应的物理页读取数据。
- **W (Write, 写权限)** - 如果设置为 1，表示允许向对应的物理页写入数据。
- **X (Execute, 执行权限)** - 如果设置为 1，表示允许从对应的物理页执行代码。
- **U (User, 用户模式访问)** - 如果设置为 1，表示该页可以被用户模式访问，否则只能被内核访问。
- **A (Accessed, 访问位)** - 如果设置为 1，表示该页已被访问。这通常用于页面替换算法。
- **D (Dirty, 脏页位)** - 如果设置为 1，表示该页已被写入，即页面已被修改过。
- **G (Global, 全局位)** - 如果设置为 1，表示该页表项在所有地址空间中都有效，不会在地址空间切换时被刷新。

# 缺页

- 请问哪些异常可能是缺页导致的？

1. **指令访问异常 (Instruction Access Fault)** - 当处理器尝试从一个未映射或权限不足的虚拟地址读取指令时触发。
2. **加载访问异常 (Load Access Fault)** - 当进行数据读取操作时，如果目标虚拟地址未映射到物理内存或者访问权限不足，则会触发此异常。
3. **存储/AMO 访问异常 (Store/AMO Access Fault)** - 写入操作时，如果虚拟地址未映射或者权限不足（例如页表项中的 W 位未设置），则会触发此异常。

* 发生缺页时，描述相关重要寄存器的值

1. **`stval`** - 此寄存器包含引起异常的虚拟地址。对于指令访问异常，它是指令的地址；对于加载或存储访问异常，它是数据访问的地址。

2. **`scause`** - 异常原因寄存器，指明了引发异常的具体原因。例如，值可能表示指令地址错、加载地址错或存储地址错等。

3. **`sepc`** - 异常程序计数器，存储发生异常的指令地址。处理异常后，可以修改此寄存器以控制程序继续执行的位置，通常是重新执行导致异常的指令。

- 这样做有哪些好处？

1. **节省内存资源**
2. **提高响应速度**
3. **减少启动时的磁盘 I/O 操作**

- 处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？

$$
10 ^ 7 字节左右
$$

- 请简单思考如何才能实现 Lazy 策略，缺页时又如何处理？描述合理即可，不需要考虑实现。

在加载程序或者申请内存时，在操作系统内将申请内存进行特别标记，如果遇到缺页中断，则检查是否存在标记，并进行分配后返回用户程序

- 此时页面失效如何表现在页表项(PTE)上？

表现为有效位被置0

# 双页表与单页表

- 在单页表情况下，如何更换页表？

在操作系统使用单页表的设计中，更换页表通常发生在进程切换时

首先**保存当前进程的上下文**，然后**加载新进程的上下文**，大概类似与现在的切换任务时的操作

* 单页表情况下，如何控制用户态无法访问内核页面？（tips:看看上一题最后一问）

设置内核页面的访问权限，禁止U特权级访问

- 单页表有何优势？（回答合理即可）

减少了切换页表的开销

- 双页表实现下，何时需要更换页表？假设你写一个单页表操作系统，你会选择何时更换页表（回答合理即可）？

在双页表情况下，陷入内核和切换进程都需要更换

在单页表情况下，切换进程时需要更换

# 荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 **以下各位** 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

   > *《无》*

2. 此外，我也参考了 **以下资料** ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

   > *《rCore-Tutorial-Book 第三版》*

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。
